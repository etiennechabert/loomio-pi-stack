# Loomio Production Configuration
# Copy this file and customize for your production deployment

# =============================================================================
# ENVIRONMENT
# =============================================================================
RAILS_ENV=production
RACK_ENV=production

# =============================================================================
# BASIC CONFIGURATION
# =============================================================================
# REQUIRED: Set to your actual domain
CANONICAL_HOST=loomio.example.com

SUPPORT_EMAIL=support@example.com
HELPER_BOT_EMAIL=noreply@example.com

# =============================================================================
# DATABASE
# =============================================================================
POSTGRES_DB=loomio_production
POSTGRES_USER=loomio
# REQUIRED: Generate with: openssl rand -base64 32
POSTGRES_PASSWORD=CHANGE_THIS_SECURE_PASSWORD

# =============================================================================
# SECRET KEYS
# =============================================================================
# REQUIRED: Generate with: openssl rand -hex 64
SECRET_KEY_BASE=GENERATE_WITH_OPENSSL_RAND_HEX_64

# REQUIRED: Generate with: openssl rand -hex 32
LOOMIO_HMAC_KEY=GENERATE_WITH_OPENSSL_RAND_HEX_32

# REQUIRED: Generate with: openssl rand -hex 32
DEVISE_SECRET=GENERATE_WITH_OPENSSL_RAND_HEX_32

# =============================================================================
# EMAIL / SMTP CONFIGURATION
# =============================================================================
# REQUIRED: Configure your SMTP server
SMTP_DOMAIN=example.com
SMTP_SERVER=smtp.example.com
SMTP_PORT=587
SMTP_USERNAME=your-smtp-username
SMTP_PASSWORD=your-smtp-password
SMTP_AUTH=plain
SMTP_USE_TLS=true

REPLY_HOSTNAME=loomio.example.com
FROM_EMAIL=noreply@example.com

# =============================================================================
# PORTS
# =============================================================================
LOOMIO_PORT=3000
CHANNELS_PORT=5000
HOCUSPOCUS_PORT=4000
ADMINER_PORT=8081
NETDATA_PORT=19999

# =============================================================================
# WEBSOCKET URLS (HTTPS/WSS for production)
# =============================================================================
# Set these to match your production domain
CHANNELS_URL=wss://loomio.example.com/cable
HOCUSPOCUS_URL=wss://loomio.example.com/hocuspocus

# =============================================================================
# SSL (Enabled for production)
# =============================================================================
FORCE_SSL=true

# =============================================================================
# INCOMING EMAIL (Reply-by-Email)
# =============================================================================
# Token to authenticate incoming email webhook requests from Cloudflare Email Worker
# REQUIRED if using Cloudflare Email Worker
# Generate with: openssl rand -hex 32
# EMAIL_PROCESSOR_TOKEN=GENERATE_WITH_OPENSSL_RAND_HEX_32

# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================
# REQUIRED: Generate with: openssl rand -hex 32
BACKUP_ENCRYPTION_KEY=GENERATE_WITH_OPENSSL_RAND_HEX_32

BACKUP_SCHEDULE="0 3 * * *"
BACKUP_RETENTION_DAYS=30

# Google Drive Integration (REQUIRED for production backups)
# IMPORTANT: Google Drive is MANDATORY for production to backup both database AND files
GDRIVE_ENABLED=true
# OAuth2 token from rclone (see OAUTH2_SETUP.md for instructions)
# Generate with: docker compose exec backup rclone authorize "drive"
GDRIVE_TOKEN='{"access_token":"YOUR_ACCESS_TOKEN","token_type":"Bearer","refresh_token":"YOUR_REFRESH_TOKEN","expiry":"2024-01-01T00:00:00Z"}'
# Folder ID where backups/files will be synced
GDRIVE_FOLDER_ID=REPLACE_WITH_FOLDER_ID

# =============================================================================
# PRODUCTION MODE = RAM MODE
# =============================================================================
# Production automatically uses RAM mode to minimize SD card writes:
#   - Database → tmpfs (RAM)
#   - Redis → tmpfs (RAM)
#   - Backups → tmpfs (RAM) → Google Drive
#   - On boot: Google Drive → tmpfs (RAM) → Database
#   - ZERO SD card writes!
#
# CRITICAL: Google Drive is MANDATORY for production (no disk persistence)
#
# Requirements:
#   ✓ 8GB+ RAM (16GB recommended for production)
#   ✓ Google Drive configured above (GDRIVE_ENABLED=true)
#   ✓ Hourly backups (BACKUP_SCHEDULE="0 * * * *" recommended)

# =============================================================================
# MONITORING (Netdata Cloud - Optional)
# =============================================================================
NETDATA_CLAIM_TOKEN=
NETDATA_CLAIM_ROOMS=

# =============================================================================
# AUTO-UPDATE (Watchtower)
# =============================================================================
WATCHTOWER_SCHEDULE="0 15 3 * * *"
WATCHTOWER_NOTIFICATIONS=
WATCHTOWER_NOTIFICATION_URL=

# =============================================================================
# CLOUDFLARE TUNNEL (Optional)
# =============================================================================
CLOUDFLARE_TUNNEL_TOKEN=

# =============================================================================
# FILE UPLOAD LIMITS
# =============================================================================
# Maximum file upload size in MB
MAX_ATTACHMENT_SIZE_MB=42

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================
PUMA_WORKERS=2
RAILS_MAX_THREADS=5
SIDEKIQ_CONCURRENCY=5
MAX_THREADS=4

# =============================================================================
# MONITORING ALERTS
# =============================================================================
# IMPORTANT: Email address to receive critical system alerts
# Netdata will send alerts for:
#   - RAM usage > 80% (warning) or > 90% (critical)
#   - CPU usage > 80% (warning) or > 95% (critical)
#   - Low available RAM < 1GB (warning) or < 500MB (critical)
#   - High system load
ALERT_EMAIL=admin@example.com

# =============================================================================
# PRODUCTION SETTINGS
# =============================================================================
RAILS_LOG_LEVEL=info
DEBUG=false
# Disable public threads for private community (users must log in to view content)
FEATURES_DISABLE_PUBLIC_THREADS=true
# Disable public registration - invite-only (admins create/invite users)
FEATURES_DISABLE_SIGNUP=true
