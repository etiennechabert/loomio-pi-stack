# Docker Compose Override for RAM-Only Mode
# Use with: docker compose -f docker-compose.yml -f docker-compose.ram.yml up
#
# WARNING: All database and Redis data will be stored in RAM only!
# Data is lost on restart. Relies on automatic backup/restore.
#
# tmpfs without size limits defaults to 50% of system RAM (8GB on 16GB system)
# Monitor RAM usage with: make ram-usage

services:
  # PostgreSQL in RAM
  db:
    tmpfs:
      # Store entire PostgreSQL data directory in RAM
      # No size limit - defaults to 50% of system RAM (~8GB)
      # Monitor with: docker stats db
      - /var/lib/postgresql/data:mode=0700
    volumes:
      # Remove db-data volume, keep only backup mount
      - ./data/db_backup:/backups

  # Redis in RAM (no persistence)
  redis:
    # Disable Redis persistence (no RDB snapshots, no AOF)
    command: redis-server --save "" --appendonly no
    tmpfs:
      # Store Redis data in RAM
      # No size limit - defaults to 50% of system RAM
      - /data:mode=0755
    # Remove redis-data volume entirely
