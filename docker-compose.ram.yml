# Docker Compose Override for RAM-Only Mode
# Use with: docker compose -f docker-compose.yml -f docker-compose.ram.yml up
#
# WARNING: Everything stored in RAM - database, Redis, AND backups!
# Data is lost on restart. Google Drive is MANDATORY for persistence.
#
# tmpfs without size limits defaults to 50% of system RAM (8GB on 16GB system)
# Monitor RAM usage with: make ram-usage

services:
  # PostgreSQL in RAM
  db:
    tmpfs:
      # Store entire PostgreSQL data directory in RAM
      # No size limit - defaults to 50% of system RAM (~8GB)
      # Monitor with: docker stats db
      - /var/lib/postgresql/data:mode=0700

  # Redis in RAM (no persistence)
  redis:
    # Disable Redis persistence (no RDB snapshots, no AOF)
    command: redis-server --save "" --appendonly no
    tmpfs:
      # Store Redis data in RAM
      # No size limit - defaults to 50% of system RAM
      - /data:mode=0755

  # Backup service with RAM-only backups
  backup:
    tmpfs:
      # Store backups in RAM (not on SD card!)
      # Backups are uploaded directly to Google Drive
      # On boot: download from GDrive → RAM → restore
      # Size: ~500MB-1GB for encrypted backup
      - /backups:mode=0755
    volumes:
      # In RAM mode, database is accessed via pg_dump over network, not filesystem
      # Only need user uploads folders (these stay on disk)
      - ./data/uploads/storage:/loomio/storage:ro
      - ./data/uploads/system:/loomio/public/system:ro
      - ./data/uploads/files:/loomio/public/files:ro
