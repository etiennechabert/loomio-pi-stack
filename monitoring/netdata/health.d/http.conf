# HTTP Metrics Health Monitoring
# Monitors Rails application HTTP traffic, response times, and error rates

# 5xx Server Error Rate - Warning
alarm: loomio_http_5xx_errors_warning
   on: rails_http.error_rate
 lookup: average -5m unaligned of rate
  units: %
  every: 30s
   warn: $this > 500
  delay: up 2m down 10m multiplier 1.5 max 1h
   info: HTTP 5xx error rate is elevated (>5% of requests)
     to: sysadmin

# 5xx Server Error Rate - Critical
alarm: loomio_http_5xx_errors_critical
   on: rails_http.error_rate
 lookup: average -5m unaligned of rate
  units: %
  every: 30s
   crit: $this > 1000
  delay: up 1m down 10m multiplier 1.5 max 1h
   info: HTTP 5xx error rate is critical (>10% of requests)
     to: sysadmin

# Average Response Time - Warning
alarm: loomio_http_response_time_warning
   on: rails_http.response_time
 lookup: average -5m unaligned of avg
  units: ms
  every: 30s
   warn: $this > 2000
  delay: up 5m down 15m multiplier 1.5 max 1h
   info: HTTP average response time is slow (>2 seconds)
     to: sysadmin

# Average Response Time - Critical
alarm: loomio_http_response_time_critical
   on: rails_http.response_time
 lookup: average -5m unaligned of avg
  units: ms
  every: 30s
   crit: $this > 5000
  delay: up 2m down 15m multiplier 1.5 max 1h
   info: HTTP average response time is very slow (>5 seconds)
     to: sysadmin

# Peak Response Time - Critical
alarm: loomio_http_response_time_peak
   on: rails_http.response_time
 lookup: max -1m unaligned of max
  units: ms
  every: 30s
   warn: $this > 10000
  delay: up 2m down 10m multiplier 1.5 max 1h
   info: HTTP peak response time is very high (>10 seconds)
     to: sysadmin

# Success Rate Drop
alarm: loomio_http_success_rate_low
   on: rails_http.success_rate
 lookup: average -5m unaligned of rate
  units: %
  every: 30s
   warn: $this < 9000
   crit: $this < 8000
  delay: up 2m down 10m multiplier 1.5 max 1h
   info: HTTP success rate (2xx) has dropped below expected levels
     to: sysadmin

# No HTTP Traffic (application might be stuck)
alarm: loomio_http_no_traffic
   on: rails_http.requests
 lookup: sum -5m unaligned of total
  units: requests
  every: 1m
   warn: $this == 0
  delay: up 5m down 5m multiplier 1.5 max 1h
   info: No HTTP requests in the last 5 minutes - application may be unresponsive
     to: sysadmin
