## CPU Usage Alerts for Loomio
## Monitors system CPU and sends alerts when usage is sustained high

# Alert when overall CPU usage is sustained high
alarm: system_cpu_usage_high
   on: system.cpu
class: System
 type: Linux
component: CPU
   os: linux
hosts: *
lookup: average -5m unaligned of user,system,nice,iowait,irq,softirq
 calc: $this
units: %
every: 1m
 warn: $this > 80
 crit: $this > 95
delay: down 10m multiplier 1.5 max 1h
 info: System CPU usage is sustained high (warning: >80%, critical: >95% for 5 minutes)
   to: sysadmin

# Alert when CPU iowait is high (indicating disk bottleneck)
alarm: system_cpu_iowait_high
   on: system.cpu
class: System
 type: Linux
component: CPU
   os: linux
hosts: *
lookup: average -5m unaligned of iowait
 calc: $this
units: %
every: 1m
 warn: $this > 30
 crit: $this > 50
delay: down 10m multiplier 1.5 max 1h
 info: CPU iowait is high (warning: >30%, critical: >50%) - indicates disk I/O bottleneck
   to: sysadmin

# Alert for individual Docker container CPU usage
alarm: container_cpu_usage_high
   on: cgroup_cpu.cpu_limit
class: Container
 type: Docker
component: Services
   os: linux
hosts: *
lookup: average -3m unaligned of used
 calc: $this
units: %
every: 1m
 warn: $this > 90
 crit: $this > 95
delay: down 10m multiplier 1.5 max 1h
 info: Docker container CPU usage is very high (warning: >90%, critical: >95%)
   to: sysadmin

# Load average alert - good for detecting sustained overload
alarm: system_load_average_high
   on: system.load
class: System
 type: Linux
component: CPU
   os: linux
hosts: *
lookup: average -5m unaligned of load15
 calc: $this / $(grep -c ^processor /proc/cpuinfo)
units: load per core
every: 1m
 warn: $this > 2
 crit: $this > 4
delay: down 15m multiplier 1.5 max 1h
 info: System load average (15min) is high (warning: >2x cores, critical: >4x cores) - system overloaded
   to: sysadmin
