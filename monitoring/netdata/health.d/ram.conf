## RAM Usage Alerts for Loomio
## Monitors system RAM and sends alerts when usage is high

# Alert when RAM usage exceeds 80%
alarm: system_ram_usage_high
   on: system.ram
class: System
 type: Linux
component: Memory
   os: linux
hosts: *
 calc: $used * 100 / ($used + $cached + $free + $buffers)
units: %
every: 1m
 warn: $this > 80
 crit: $this > 90
delay: down 5m multiplier 1.5 max 1h
 info: System RAM usage is high (warning: >80%, critical: >90%)
   to: sysadmin

# Alert when available RAM is critically low (less than 500MB)
alarm: system_ram_available_low
   on: system.ram
class: System
 type: Linux
component: Memory
   os: linux
hosts: *
 calc: $available
units: MB
every: 1m
 warn: $this < 1000
 crit: $this < 500
delay: down 5m multiplier 1.5 max 1h
 info: Available RAM is critically low (warning: <1GB, critical: <500MB)
   to: sysadmin

# Alert specific to RAM mode - database using too much RAM
alarm: database_ram_usage_high
   on: cgroup_mem_ram.mem_usage
class: Container
 type: Docker
component: PostgreSQL
   os: linux
hosts: *
lookup: average -1m unaligned of used
 calc: $this / 1024 / 1024
units: MB
every: 2m
 warn: $this > 4000
 crit: $this > 6000
delay: down 10m multiplier 1.5 max 1h
 info: PostgreSQL container using excessive RAM (warning: >4GB, critical: >6GB) - may indicate RAM mode issue
   to: dba
